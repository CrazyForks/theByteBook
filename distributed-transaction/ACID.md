# 5.1 数据一致性

引入事务的目的，是为了保证数据的一致性（Consistency），也就是保证数据的完整性没有破坏，完整性包括数据库外键约束以及业务定义的约束不会被破坏。

笔者举一个具体的例子帮助你理解：假设我们在处理一个转账业务，其中 A 向 B 转账 ￥50 元。在事务的支持下，无论是在转账前、转账过程中，还是转账完成后，A 和 B 的总金额始终保持不变。这意味着数据在整个过程中都保持一致，符合业务约束。

想要达成数据的一致性，需要 3 个方面的努力：

- **原子性（A**tomic）：一个事务中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被恢复到事务开始前的状态，就像这个事务从来没有执行过一样。
- **隔离性（I**solation）：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。
- **持久性（D**urability）：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。

这也就是常说的事务的“ACID 特性”。值得一提的是，对于一致性而言，A、I、D 是手段，C（Consistency）是 3 者协作的目标，弄到一块完全是为了读起来顺口。


当事务的影响范围局限在单机本地内的系统时，一致性通过编码实现起来水到渠成，但倘若事务修改的对象影响涉及外部，例如跨越服务、跨越不同的数据源时，一致性问题通常很难再使用 A、I、D 来解决，但是外部一致性又是分布式系统中必然会遇到且必须要解决的问题。这种情况下，我们就要转变观念，将一致性视为一个多元问题，而非简单的“是或否”的二元问题。根据不同场景的需求，对一致性的强度进行分级讨论，在确保代价可承受的前提下，最大程度地保障系统的一致性。

一致性的强弱程度关乎系统设计权衡，由此事务处理从一个具体操作上的“编程问题”转变成一个需要全局权衡的“架构问题”。人们在探索这些架构的设计时产生了诸多思路和理论，这其中最为出名的就是一致性与可用性的权衡定理 —— CAP 定理。