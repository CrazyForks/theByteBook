# 第五章：数据一致性与分布式事务模型

:::tip <a/>

网络是不稳定的，延迟是不可预测的，带宽是有限的，拓扑是动态的，一切都会失败。

:::right
—— 改自于分布式计算八大谬误[^1]
:::


提及事务，最早指对数据库的多个读、写操作捆绑在一起成一个逻辑操作单元。即事务中的所有读写是一个执行的整体，整个事务要么成功，要么失败，从而保证数据在某极端情况下的完整性和一致性。不过分布式系统盛行之后，事务处理的范畴不再局限于数据库内，所有需要保证数据一致性的应用场景，包括但不限于缓存、消息队列、存储、微服务架构之下的业务一致性处理等等，都需要用到事务进行处理。

如果事务的影响只局限在本地，如何实现事务仅仅是个编码问题，但若涉及了跨多个网络节点的操作，保证分布式系统下数据的完整性和一致性便成了架构设计问题。2000 年以前，人们曾经希望在数据库领域运行良好的 XA[^2] 事务机制，也能在分布式环境中顺利运行，但这个愿望被 CAP 定理粉碎，分布式事务的篇章我们从 ACID 与 CAP 的矛盾说起。

:::center
  ![](../assets/distributed-transaction.png)
  图 5-0 本章内容导图
:::

[^1]: 分布式计算八大谬误出现背景是，人们在设计和开发分布式系统时，常常将中心化系统的经验和假设直接应用到分布式环境中，忽视了分布式环境的复杂性和特殊需求。这些谬误可以视为分布式系统设计时需要考虑的架构需求。
[^2]: XA 是由 X/Open 组织提出的分布式事务的规范，全称是 eXtended Architecture，大部分数据库支持的 XA 协议基于 2PC 实现。