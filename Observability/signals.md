# 9.3 可观测数据的分类及处理

业界将系统输出的数据总结为三种独立的类型：指标（metrics）、日志（logs）和链路追踪（traces），它们被称为可观测性的“三大支柱”。

- **指标（metrics）**：量化系统性能和状态的“数据点”，每个数据点包含度量对象（描述监控内容，如请求数）、度量值（具体数值，如 100 次/秒）和时间戳（采集时刻），例如，“2024-12-27 10:00:00，CPU 使用率为 75%”。多个连续的数据点便可以分析系统性能的趋势和变化规律。指标是发现问题的起点，例如你收到一条告警：“12 点 22 分，接口请求成功率下降到 10%”，这表明系统出现了问题。接着，你结合链路追踪和日志数据深入分析，找到问题的根本原因并进行修复。

- **日志（logs）**：系统运行过程中，记录离散事件的文本数据，每条日志详细描述事件操作对象、操作结果、操作时间。例如下面的日志，提供了时间戳、日志级别（ERROR）以及事件描述。
```bash
[2024-12-27 14:35:22] ERROR: Failed to connect to database. Retry attempts exceeded.
```
日志为问题诊断提供了精准的上下文信息，与指标形成互补。当系统故障时，“指标”告诉你应用程序出现了问题，“日志”则解释了问题出现的原因。

- **链路追踪（traces）**：记录单个请求在多个服务之间的传播路径（Trace），包括流经的节点（span）、耗时分布及相关上下文信息。链路追踪以追踪树（Trace Tree）的形式直观呈现请求的调用链路，帮助工程师在复杂的分布式系统中快速定位异常点和性能瓶颈。

```bash
// 追踪树
Trace ID: 12345
└── Span ID: 1 - API Gateway (Duration: 50ms)
    └── Span ID: 2 - User Service (Duration: 30ms)
        └── Span ID: 3 - Database Service (Duration: 20ms)
```

上述三类数据各自侧重不同，但并非孤立存在，有着天然的交集与互补，例如，指标监控（告警）可帮助发现问题，日志和链路追踪则进一步帮助定位根本原因。这三者之间的关系，如下图 9-2 的韦恩图所示。

:::center
  ![](../assets/observability.jpg)<br/>
 图 9-2 指标、链路追踪、日志三者之间的关系 [图片来源](https://peter.bourgon.org/blog/2017/02/21/metrics-tracing-and-logging.html)
:::


现在，CNCF 发布的可观测性白皮书中[^1]，将系统输出的各类观测数据统一称为信号（Signals）。主要的信号除了 指标、日志、链路追踪之外又增加了性能剖析（Profiling）和核心转储（Core dump）。

接下来，笔者将详细介绍可观测系统中各类信号的采集、存储和分析处理设计，以及面对海量数据规模时遇到的技术挑战。

[^1]: 参见 https://github.com/cncf/tag-observability/blob/main/whitepaper.md