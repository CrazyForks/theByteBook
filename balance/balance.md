# 4.1 负载均衡概述

分布式系统中，负载均衡最主要的作用是当处理大量用户请求时，将请求尽量均衡地分配到多台服务器进行处理，每台服务器处理其中一部分而不是所有的用户请求，避免因单机处理能力的上限，导致系统崩溃而无法提供服务。

值得注意的是，业内讨论负载均衡技术时，负载均衡和代理两个术语经常无差别混用。严格讲并非所有代理软件都是负载均衡器，但绝大多数代理软件都有负载均衡功能，笔者沿用这种惯例，认为二者整体上对等。

如图 4-1 所示的负载均衡高层架构图，若干客户端（Client）正在访问若干后端服务（RealServer），中间的负载均衡器（Load Balancer）作为分布式系统的唯一入口起到以下作用：

- **服务发现**：系统中哪些后端可用、它们的地址是什么（负载均衡器如何能够联系上它们）；
- **健康检查**：负载均衡器定期对后端服务进行健康检查。健康检查包括检查后端服务器的响应时间、服务的状态码等。根据健康检查的结果，负载均衡器将请求仅发送给健康的后端服务器，并在发现某个后端服务器不健康时，将其从负载均衡池中剔除，避免向故障服务发送请求。
- **负载均衡**：负载均衡器使用合适的负载均衡算法（如轮询、最少连接、加权分配等）将请求均匀地分发到健康的后端服务。确保请求的公平分配，提高系统整体的处理能力和稳定性。

:::center
  ![](../assets/balancer.svg)<br/>
 图 4-1 负载均衡工作模型
:::

负载均衡使用得当可以给分布式系统带来很多好处：

- **命名抽象**：客户端通过预设机制（如内置库、DNS 等）访问负载均衡器，免去了了解具体后端服务的复杂性。这种抽象使得客户端无需直接知道后端服务的详细信息，通过服务发现机制，负载均衡器会动态处理后端的变化；
- **容错**：负载均衡器通过健康检查和多种负载均衡算法，能够将请求路由到正常运行的后端服务。这样，运维人员可以在出现故障时从容地进行修复，而不会影响系统的整体可用性。
- **成本和性能收益**：分布式系统往往跨越多个网络区域（Zone/Region），而负载均衡器通过策略优化流量路由，可以最大程度地将请求保持在同一网络区域内。这不仅提高了性能（减少延迟），还降低了系统成本（减少跨区域带宽费用）。

