# 4.3 四层负载均衡

所谓的“四层负载均衡”（Layer 4 Load Balancer，简称 L4），并非仅指其在 OSI 模型的第四层（传输层）工作，而是指四层负载均衡所有工作模式的共同特点是，维持传输层连接（如 TCP、UDP）特性。

实际上，四层负载均衡器的不同工作模式涉及多个网络层：在第二层（数据链路层）通过改写 MAC 地址实现请求转发；在第三层（网络层）改写 IP 地址完成请求路由；在第四层（传输层）修改 UDP 或 TCP 的端口和连接地址，并通过 NAT 方式实现请求转发。

在 OSI 模型中，物理层、链路层和网络层统称为媒体层（Media Layer），用于处理数据传输的实际介质和路由；传输层以上的层次（会话层、表示层和应用层）则称为主机层（Host Layer），负责主机级的数据处理。严格来说，当请求进入主机层后，便是“请求转发”。但出于习惯，所有的资料都把它们称为四层负载均衡。本节，笔者继续沿用这种惯例，来自客户端的请求，无论是在网络层处理，还是在传输层的处理，统称为四层负载均衡处理。