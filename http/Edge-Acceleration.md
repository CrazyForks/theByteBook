# 2.7 使用 DSA 服务优化全球网络

如 2.2 节所言，如果仅是传输层、应用层的优化，无论何种手段都无法突破物理瓶颈限制。例如一个国际化服务，受跨国、跨海等国际链路影响，网络延迟不可控，想要降低难度也大幅增加。除此，还有个现实无法忽视：「**互联网中两个节点之间的路由往往不是路径最短，而是各个 AS 连接费用最低的策略**」[^1]。

提升长链路中的网络质量，我们不妨换个思路，使用商业性质（花钱）的服务跨过物理瓶颈。

目前主流的 CDN 服务商，例如 Akamai、Fastly、Cloudfront、Azure 等都提供全球性的 DSA（Dynamic Site Accelerator，动态加速网络）服务。这些服务商在全球各区域部署了近几十万台边缘设备，组建出一个规模巨大的全球化内部网络。使用此类的 DSA 服务能明显改善因跨运营商和跨国引发的网络延迟、丢包和服务不稳定等问题。

使用动态加速网络流程大致如下：

1. 源站提供一个 20KB 用于探测的资源。
2. 服务商会在源站周边选择一批候选边缘节点。
3. 候选边缘节点对测试资源进行下载测试，多个候选边缘节点多路探索后，根据丢包率、RTT、hops 数等选择最佳的路由线路。

<div  align="center">
	<img src="../assets/dsa.png" width = "550"  align=center />
	<p>图 2-30 动态加速网络服务</p>
</div>

根据我使用 Akamai 加速服务的抽样数据看，如表 2-4 所示，整体连接速度提升了 30% 右。

表 2-4 动态加速网络效果对比

区域|直连|Akamai 加速|提升
:---|:--:|:--:|:--
Bangkok|0.58s|0.44s|31%
jakarta|0.57s|0.44s|31%
Kuala Lumpur|0.52s|0.38|36%
Taibei|0.51s|0.40s|37%
Hanoi Bac Mai|0.54s|0.41s|30%
Singapore|0.58s|0.39s|48%
Hong Kong|0.38s|0.24s|58%
Tokyo|0.60s|0.45s|32%
Surabaya|0.67s|0.52s|29%
Manila|0.46s|0.34s|36%

[^1]: 我曾在上海使用 mtr 工具测试一个新加坡节点路由状态，数据包先到香港 AS，香港转到美国 AS，再从美国转到新加坡 AS。
