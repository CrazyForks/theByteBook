# 2.7 使用“动态加速服务”优化全球网络

网络链路越长，两个节点之间的延迟越大，如果是一个全球化的网络服务，受跨国、跨海等国际链路影响，想要降低难度也大幅增加。


除此，互联网中的节点通信还有个现实不能忽视：**“两个节点之间的数据传输并不总是遵循最短路径原则，而是受到各自主控的自治系统（AS）之间的连接成本和策略的影响”**。这意味着，数据路由往往是基于成本效益分析的结果，而非单纯的地理或拓扑距离[^1]。

:::tip 什么是 AS
AS（Autonomous System，自治系统）具有统一路由策略的巨型网络或网络群组，每个自治系统被分配一个唯一的 AS 号，各个 AS 之间使用 BGP 协议进行识别和通告路由，全世界最大规模的 AS 网络就是互联网。
:::

为了提升长距离链路中的网络传输质量，不妨换个思路，使用商业性质（花钱）来克服物理链路的局限性。

目前主流的 CDN 服务商，例如 Akamai、Fastly、Cloudfront、Azure 等都提供全球性的 DSA（Dynamic Site Accelerator，动态加速网络）服务。

这些服务在全球各区域部署了近几十万台边缘设备，组建出一个规模巨大的全球化内部网络，利用这些服务商的网络基础设施，可以显著减少因跨不同运营商和跨国界传输所导致的网络延迟、丢包和连接不稳定等问题。

使用动态加速网络服务也比较简单，只要域名 CNAME 到 CDN 服务商提供的域名后，整个加速就能自动实现。流程大致如下：

1. 源站将域名 CNAME 到 CDN 服务商提供的域名，例如将 www.thebyte.ocm.cn CNAME  到 thebyte.akamai.com。
2. 源站提供一个 20KB 左右的用于探测网络质量的文件资源。
3. 服务商在源站周边选择一批候选边缘节点。
4. 候选边缘节点对测试资源进行下载测试，多个候选边缘节点多路探索后，根据丢包率、RTT、hops 数等，选择出客户端到源站之间的最佳的路由线路。

:::center
  ![](../assets/dsa.png)<br/>
 图 2-24 动态加速网络服务加速原理 [图片来源](https://www.cdnetworks.com/cn/web-performance/dynamic-web-acceleration/)
:::

根据笔者使用 Akamai 加速服务，观测的效果数据看，整体连接速度提升了 30% 右，如表 2-4 所示。

:::center
表 2-4 动态加速网络效果对比
:::
区域|直连|Akamai 加速|提升
:---|:--:|:--:|:--
Bangkok|0.58s|0.44s|31%
jakarta|0.57s|0.44s|31%
Kuala Lumpur|0.52s|0.38|36%
Taibei|0.51s|0.40s|37%
Hanoi Bac Mai|0.54s|0.41s|30%
Singapore|0.58s|0.39s|48%
Hong Kong|0.38s|0.24s|58%
Tokyo|0.60s|0.45s|32%
Surabaya|0.67s|0.52s|29%
Manila|0.46s|0.34s|36%

[^1]: 笔者曾在上海使用 mtr 工具测试一个新加坡节点路由状态，数据包先到香港 AS，香港转到美国 AS，再从美国转到新加坡 AS。
